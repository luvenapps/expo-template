# Project Updates

- **Design system on** — Tamagui is configured (`tamagui.config.ts`) and available through the new `AppProviders` wrapper so every screen shares fonts, spacing, and theme tokens.
- **Unified providers** — `src/ui/providers/AppProviders.tsx` centralises `GestureHandlerRootView`, `SafeAreaProvider`, Tamagui, and the status bar; `app/_layout.tsx` simply imports the wrapper via the `@/` alias.
- **Project scaffolding** — Added a lightweight `src/` folder structure (auth, data, notifications, state, sync, utils, ui) plus TypeScript/Jest path aliases (`@/*`) to keep upcoming modules organised.
- **Details screen refresh** — Converted `app/details.tsx` to Tamagui primitives with matching tests, keeping the starter UI consistent across routes.
- **Tabs scaffold** — Restructured Expo Router to add /(tabs) with Today + Settings placeholders and root redirect, aligning with future navigation.
- **Safe area padding** — Today and Settings screens now respect native safe-area insets to ensure hero copy is visible on iOS/Android builds.
- **Tamagui cleanup** — Replaced shorthand props with explicit padding/alignment on Details and Settings screens to standardise style usage.
- **ScreenContainer** — Added a shared safe-area aware layout component and migrated Today, Settings, and Details screens to it while removing Tamagui shorthands.
- **SQLite scaffolding** — Installed expo-sqlite with Drizzle, added drizzle.config.ts, schema definitions, and helper scripts for upcoming offline data work.
- **Sync groundwork** — Added TanStack Query + Zustand deps, a reusable ScreenContainer, safe-area cursor storage (MMKV fallback), and outbox utilities for upcoming sync flows.
- **Sync utils tests** — Added unit coverage for queryClient singleton, cursor storage, repository helper, and outbox DB interactions using mock adapters.
- **Sync engine scaffold** — Added Zustand sync store, generic sync engine with tests, and mocked outbox/cursor coverage to keep infrastructure reusable.
- **Auth shell** — Added Supabase client/session store scaffolding with Zustand, plus initial auth listener test coverage.
- **Auth navigation** — Added /app/(auth) stack with placeholder login, session-aware root redirect, and updated tests for the new guard.
- **Auth service** — Extended session store with loading/error states, wired the login form to Supabase helpers, and added comprehensive tests while keeping auth optional.
- **Auth refactor: local-first** — Removed authentication wall; all users now access the full app immediately with local storage. Moved Sign In/Out to Settings screen, simplified root redirect.Authentication is now opt-in for sync and future premium features.
- **Sync manager** — Added useSync hook with auto scheduling and interval handling plus generic settings integration.
- **Notifications baseline** — Added reusable notification helpers with permission handling, scheduling, and Jest coverage across native/web fallbacks.
- **Domain config system** — Extracted all entity and app names to `src/config/domain.config.ts`, making the codebase template-ready. Schema exports renamed to generic `primaryEntity`, `entryEntity`, `reminderEntity`, `deviceEntity` while maintaining runtime table names and full type safety.

- **Theme provider rebuilt** — Centralised Tamagui theming inside `ThemeProvider` with Expo Router integration so the entire app responds to light/dark/system choices.
- **Theme persistence** — Preference storage now pulls namespace keys from `DOMAIN`, saving to MMKV/native storage with web localStorage fallback and consistent hydration logs.
- **Settings toggle polish** — Replaced text labels with icon buttons, enforced consistent sizing, and aligned ordering (system → light → dark) for parity with the rest of the UI.
- **Theme tests** — Expanded `ThemeProvider` test suite to cover hydration, persistence, system updates, and error handling for full coverage.
- **Supabase schema landed** — Added `supabase/migrations/0001_sync_schema.sql` with habits, entries, reminders, and devices tables plus indices and RLS policies mirroring the local SQLite model.
- **Edge functions online** — Implemented `sync-push`, `sync-pull`, and `export` Deno functions that import DOMAIN config, enforce auth, merge conflicts, and stream CSV exports.
- **Driver alignment** — Updated `src/sync/driver.ts` to consume remote table names, process push responses, and share mapping logic across pull/push flows with extended Jest coverage.
- **Tooling tweaks** — Excluded Deno sources from `tsconfig.json` to keep Expo type-checking clean.
- **Docs refreshed** — README, AGENTS.md, and docs/roadmap.md now outline Supabase deploy commands and the Stage 2 status.
- **Supabase CLI helpers** — Vendored the CLI via devDependencies and documented `npm exec supabase` / `npm run supabase:push` for local + CI usage.
- **Supabase shared tests** — Moved shared mapping logic into `src/supabase` for reuse and added Jest coverage to guard domain/mapper helpers.
- **Local Supabase flow** — Docs now describe `npx supabase start`, container runtime setup, and using the vendored CLI (`npm run supabase:push`) for both local and hosted deployments.
- **Environment split** — `.env.local` now targets the Docker stack, `.env.prod` captures hosted credentials, and `.env.example` explains both workflows.
- **Supabase scripts** — Added `npm run supabase:dev` for local bootstrap (start/stop, migrations, function serve) and `npm run supabase:deploy` for CI-friendly cloud pushes.
- **Developer experience** — Migration workflow consolidated under `npm run db:migrate`, new helpers (`generate-migrations.mjs`, `generate-postgres-migration.mjs`, `generate-rls-policies.mjs`, `troubleshoot.mjs`) automate schema + diagnostics tasks.
- **Docs & safeguards** — Added `docs/database-migrations.md`, `docs/schema-architecture.md`, and README guidance covering migration validation, schema sync tests, and the four-step schema change workflow.
- **Breaking change** — Manual SQL migrations removed; use the Drizzle-driven pipeline (`npm run db:migrate`) and updated config filenames (`drizzle.config.sqlite.ts`, `drizzle.config.postgres.ts`).
